import { VerticalBox } from "std-widgets.slint";
import { DesktopSizes, DesktopColors, DesktopTypography } from "../theme.slint";
import { ChatMessage } from "../types.slint";

export component ChatDetailPage inherits Rectangle {
    in-out property <[ChatMessage]> chat-messages;
    in property <bool> is-loading: false;
    in property <string> agent-name: "";

    background: DesktopColors.background;
    horizontal-stretch: 1;

    VerticalLayout {
        padding: DesktopSizes.space_lg;
        spacing: DesktopSizes.space_md;

        // Loading indicator
        if root.is-loading: Rectangle {
            background: DesktopColors.surface;
            border-radius: DesktopSizes.radius_sm;
            border-width: DesktopSizes.border_thin;
            border-color: DesktopColors.border_medium;

            VerticalBox {
                padding: DesktopSizes.space_md;
                spacing: DesktopSizes.space_sm;
                alignment: center;

                Text {
                    text: "Executing " + root.agent-name + " agent...";
                    font-size: DesktopTypography.font_base;
                    color: DesktopColors.text_secondary;
                    horizontal-alignment: center;
                }

                Rectangle {
                    height: 4px;
                    width: 200px;
                    background: DesktopColors.border_light;
                    border-radius: DesktopSizes.radius_sm;

                    Rectangle {
                        height: 4px;
                        width: 60px;
                        background: DesktopColors.primary;
                        border-radius: DesktopSizes.radius_sm;
                    }
                }
            }
        }

        // User's first message at the top
        if !root.is-loading && root.chat-messages.length > 0: Rectangle {
            background: DesktopColors.surface;
            border-radius: DesktopSizes.radius_sm;
            border-width: DesktopSizes.border_thin;
            border-color: DesktopColors.border_medium;

            VerticalBox {
                padding: DesktopSizes.space_md;
                spacing: DesktopSizes.space_sm;

                Text {
                    text: "You";
                    font-size: DesktopTypography.font_sm;
                    font-weight: DesktopTypography.weight_medium;
                    color: DesktopColors.text_secondary;
                }

                VerticalBox {
                    padding: DesktopSizes.space_md;

                    Rectangle {
                        background: DesktopColors.background;
                        border-radius: DesktopSizes.radius_sm;

                        Text {
                            text: root.chat-messages[0].content;
                            font-size: DesktopTypography.font_base;
                            color: DesktopColors.text_primary;
                            wrap: word-wrap;
                        }
                    }
                }
            }
        }

        // Agent responses - iterate through messages
        for message in root.chat-messages: Rectangle {
            background: DesktopColors.surface;
            border-radius: DesktopSizes.radius_sm;
            border-width: DesktopSizes.border_thin;
            border-color: DesktopColors.border_medium;

            visible: !root.is-loading && message.role == "assistant";

            VerticalBox {
                padding: DesktopSizes.space_md;
                spacing: DesktopSizes.space_sm;

                Text {
                    text: "Agent";
                    font-size: DesktopTypography.font_sm;
                    font-weight: DesktopTypography.weight_medium;
                    color: DesktopColors.text_secondary;
                }

                VerticalBox {
                    padding: DesktopSizes.space_md;

                    Rectangle {
                        background: DesktopColors.background;
                        border-radius: DesktopSizes.radius_sm;

                        Text {
                            text: message.content;
                            font-size: DesktopTypography.font_base;
                            color: DesktopColors.text_primary;
                            wrap: word-wrap;
                        }
                    }
                }
            }
        }
    }
}
