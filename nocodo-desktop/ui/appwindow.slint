import { DesktopTypography } from "theme.slint";
import { ApiKeyEntry, AgentEntry, ChatMessage } from "types.slint";
import { SideBar } from "components/sidebar.slint";
import { StatusBar } from "components/statusbar.slint";
import { ChatsPage, ChatDetailPage, SettingsPage } from "pages/pages.slint";

export component AppWindow inherits Window {
    preferred-width: 1024px;
    preferred-height: 900px;
    min-width: 600px;
    min-height: 830px;
    max-width: 3000px;
    max-height: 2000px;
    title: "NocoDo Desktop";
    default-font-family: DesktopTypography.font_family;

    property <string> current-page: "chats";
    in-out property <[ApiKeyEntry]> api-keys: [];
    in-out property <[AgentEntry]> agents: [];
    in-out property <[string]> agent-names: ["Loading agents..."];
    in-out property <[ChatMessage]> chat-messages: [
        { role: "user", content: "Analyze the users table in my SQLite database" },
        {
            role: "assistant",
            content: "I'll analyze the users table in your SQLite database. Let me first check the structure and then provide insights.\n\n## Schema Analysis\n\nThe users table has the following columns:\n- id: INTEGER PRIMARY KEY\n- username: TEXT UNIQUE\n- email: TEXT\n- created_at: TIMESTAMP\n\n## Data Summary\n\nThe table contains 150 user records. The most recent user was created on 2025-01-04.\n\n## Observations\n\n1. All usernames are unique (as enforced by the UNIQUE constraint)\n2. Email format validation should be considered\n3. The created_at timestamps are consistent\n\nWould you like me to perform any specific queries on this data?"
        }
    ];

    callback load-settings();
    callback load-agents();

    VerticalLayout {
        spacing: 0;

        HorizontalLayout {
            spacing: 0;
            vertical-stretch: 1;
            min-height: 800px;

            // Left sidebar
            sidebar := SideBar {
                current-page: root.current-page;
                page-selected(page) => {
                    root.current-page = page;
                }
            }

            // Main content area - page components
            if root.current-page == "chats": ChatsPage {
                agent-names: root.agent-names;
            }

            if root.current-page == "chat-detail": ChatDetailPage {
                chat-messages: root.chat-messages;
            }

            if root.current-page == "settings": SettingsPage {
                api-keys: root.api-keys;
            }
        }

        // Bottom status bar
        StatusBar { }
    }
}
