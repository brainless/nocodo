import { DesktopTypography } from "theme.slint";
import { ApiKeyEntry, AgentEntry, ChatMessage } from "types.slint";
import { SideBar } from "components/sidebar.slint";
import { StatusBar } from "components/statusbar.slint";
import { ChatsPage, ChatDetailPage, SettingsPage } from "pages/pages.slint";

export component AppWindow inherits Window {
    preferred-width: 1024px;
    preferred-height: 900px;
    min-width: 600px;
    min-height: 830px;
    max-width: 3000px;
    max-height: 2000px;
    title: "NocoDo Desktop";
    default-font-family: DesktopTypography.font_family;

    in-out property <string> current-page: "chats";
    in-out property <[ApiKeyEntry]> api-keys: [];
    in-out property <[AgentEntry]> agents: [];
    in-out property <[string]> agent-names: ["Loading agents..."];
    in-out property <[ChatMessage]> chat-messages: [];
    in-out property <bool> is-loading-chat: false;
    in-out property <string> current-session-agent-name: "";
    in-out property <string> input-text: "";
    in-out property <int> chats-selected-index: -1;

    callback load-settings();
    callback load-agents();
    callback handle-start-agent();

    VerticalLayout {
        spacing: 0;

        HorizontalLayout {
            spacing: 0;
            vertical-stretch: 1;
            min-height: 800px;

            // Left sidebar
            sidebar := SideBar {
                current-page: root.current-page;
                page-selected(page) => {
                    root.current-page = page;
                }
            }

            // Main content area - page components
            if root.current-page == "chats": ChatsPage {
                agent-names: root.agent-names;
                input-text <=> root.input-text;
                selected-agent-index <=> root.chats-selected-index;
                start-agent-clicked => {
                    root.handle-start-agent();
                }
            }

            if root.current-page == "chat-detail": ChatDetailPage {
                chat-messages: root.chat-messages;
                is-loading: root.is-loading-chat;
                agent-name: root.current-session-agent-name;
            }

            if root.current-page == "settings": SettingsPage {
                api-keys: root.api-keys;
            }
        }

        // Bottom status bar
        StatusBar { }
    }
}
